<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_20) on Mon Jul 25 01:36:45 MDT 2011 -->
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<TITLE>
CryptoToken (ESAPI 2.0.1 API)
</TITLE>

<META NAME="date" CONTENT="2011-07-25">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="CryptoToken (ESAPI 2.0.1 API)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/CryptoToken.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../org/owasp/esapi/crypto/CryptoHelper.html" title="class in org.owasp.esapi.crypto"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../org/owasp/esapi/crypto/KeyDerivationFunction.html" title="class in org.owasp.esapi.crypto"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?org/owasp/esapi/crypto/CryptoToken.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="CryptoToken.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
org.owasp.esapi.crypto</FONT>
<BR>
Class CryptoToken</H2>
<PRE>
java.lang.Object
  <IMG SRC="../../../../resources/inherit.gif" ALT="extended by "><B>org.owasp.esapi.crypto.CryptoToken</B>
</PRE>
<HR>
<DL>
<DT><PRE>public class <B>CryptoToken</B><DT>extends java.lang.Object</DL>
</PRE>

<P>
Compute a cryptographically secure, encrypted token containing
 optional name/value pairs. The cryptographic token is computed
 like this:
 <pre>
     username;expiration_time;[&lt;attr1&gt;;&lt;attr2&gt;;...;&lt;attrN&gt;;]
 </pre>
 where
 <i>username</i> is a user account name. Defaults to &lt;anonymous&gt; if
 not set and it is always converted to lower case as per the rules of the
 default locale. (Note this lower case conversion is consistent with the
 default reference implementation of ESAPI's <code>User</code> interface.)
 <br>
 <i>expiration_time</i> is time (in milliseconds) after which the encrypted
 token is considered invalid (i.e., expired). The time is stored as
 milliseconds since midnight, January 1, 1970 UTC, and optional attributes
 <br>
 &nbsp;&nbsp;<i>&lt;attr1&gt;</i>;<i>&lt;attr2&gt;</i>;...<i>&lt;attrN&gt;</i>;
 <br>
 are optional semicolon (';') separated name/value pairs, where each
 name/value pair has the form:
 <pre>
         name=[value]        (value may be empty, but not null)
 </pre>
 The attribute value may contain any value. However, values containing
 either '=' or ';' will be quoted using '\'. Likewise, values containing '\'
 will also be quoted using '\'. Hence if original name/value pair were
             name=ab=xy\;
         this would be represented as
             name=ab\=xy\\\;
 To ensure things are "safe" (from a security perspective), attribute
 <i>names</i> must conform the the Java regular expression
 <pre>
          [A-Za-z0-9_\.-]+
 </pre>
 The attribute <i>value</i> on the other hand, may be any valid string. (That
 is, the value is not checked, so beware!)
 <p>
 This entire semicolon-separated string is then encrypted via one of the 
 <code>Encryptor.encrypt()</code> methods and then base64-encoded, serialized
 IV + ciphertext + MAC representation as determined by
 <code>CipherTextasPortableSerializedByteArray()</code> is used as the
 resulting cryptographic token.
 <p>
 The attributes are sorted by attribute name and the attribute names
 must be unique. There are some restrictions on the attribute names.
 (See the <A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setAttribute(java.lang.String, java.lang.String)"><CODE>setAttribute(String, String)</CODE></A> method for details.)
<P>

<P>
<DL>
<DT><B>Since:</B></DT>
  <DD>2.0</DD>
<DT><B>Author:</B></DT>
  <DD>kevin.w.wall@gmail.com</DD>
</DL>
<HR>

<P>
<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#ANONYMOUS_USER">ANONYMOUS_USER</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Represents an anonymous user.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#CryptoToken()">CryptoToken</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create a cryptographic token using default secret key from the
 <b>ESAPI.properties</b> property <b>Encryptor.MasterKey</b>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#CryptoToken(javax.crypto.SecretKey)">CryptoToken</A></B>(javax.crypto.SecretKey&nbsp;skey)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create a cryptographic token using specified <code>SecretKey</code>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#CryptoToken(javax.crypto.SecretKey, java.lang.String)">CryptoToken</A></B>(javax.crypto.SecretKey&nbsp;skey,
            java.lang.String&nbsp;token)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create cryptographic token using previously encrypted token that was
 encrypted with specified secret key.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#CryptoToken(java.lang.String)">CryptoToken</A></B>(java.lang.String&nbsp;token)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create using previously encrypted token encrypted with default secret
 key from <b>ESAPI.properties</b>.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#addAttributes(java.util.Map)">addAttributes</A></B>(java.util.Map&lt;java.lang.String,java.lang.String&gt;&nbsp;attrs)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add the specified collection of attributes to the current attributes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#clearAttributes()">clearAttributes</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Removes all the attributes (if any) associated with this token.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getAttribute(java.lang.String)">getAttribute</A></B>(java.lang.String&nbsp;name)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retrieve the attribute with the specified name.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.util.Map&lt;java.lang.String,java.lang.String&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getAttributes()">getAttributes</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retrieve a <code>Map</code> that is a clone of all the attributes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;long</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getExpiration()">getExpiration</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return the expiration time in milliseconds since epoch time (midnight,
 January 1, 1970 UTC).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.util.Date</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getExpirationDate()">getExpirationDate</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return the expiration time as a <code>Date</code>.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getToken()">getToken</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return the new encrypted token as a base64-encoded string, encrypted with
 the specified <code>SecretKey</code> with which this object was constructed.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getToken(javax.crypto.SecretKey)">getToken</A></B>(javax.crypto.SecretKey&nbsp;skey)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return the new encrypted token as a base64-encoded string, encrypted with
 the specified <code>SecretKey</code> which may be a different key than what the
 token was originally encrypted with.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getUserAccountName()">getUserAccountName</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Retrieve the user account name associated with this <code>CryptoToken</code>
 object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#isExpired()">isExpired</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check if token has expired yet.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setAttribute(java.lang.String, java.lang.String)">setAttribute</A></B>(java.lang.String&nbsp;name,
             java.lang.String&nbsp;value)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set a name/value pair as an attribute.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setExpiration(java.util.Date)">setExpiration</A></B>(java.util.Date&nbsp;expirationDate)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set expiration time for a specific date/time.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setExpiration(int)">setExpiration</A></B>(int&nbsp;intervalSecs)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set expiration time to expire in 'interval' seconds (NOT milliseconds).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setUserAccountName(java.lang.String)">setUserAccountName</A></B>(java.lang.String&nbsp;userAccountName)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set the user account name associated with this cryptographic token
 object.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#updateToken(int)">updateToken</A></B>(int&nbsp;additionalSecs)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Update the (current) expiration time by adding the specified number of
 seconds to it and then re-encrypting with the current <code>SecretKey</code>
 that was used to construct this object.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.Object</B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="ANONYMOUS_USER"><!-- --></A><H3>
ANONYMOUS_USER</H3>
<PRE>
public static final java.lang.String <B>ANONYMOUS_USER</B></PRE>
<DL>
<DD>Represents an anonymous user.
<P>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../constant-values.html#org.owasp.esapi.crypto.CryptoToken.ANONYMOUS_USER">Constant Field Values</A></DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="CryptoToken()"><!-- --></A><H3>
CryptoToken</H3>
<PRE>
public <B>CryptoToken</B>()</PRE>
<DL>
<DD>Create a cryptographic token using default secret key from the
 <b>ESAPI.properties</b> property <b>Encryptor.MasterKey</b>.
<P>
</DL>
<HR>

<A NAME="CryptoToken(javax.crypto.SecretKey)"><!-- --></A><H3>
CryptoToken</H3>
<PRE>
public <B>CryptoToken</B>(javax.crypto.SecretKey&nbsp;skey)</PRE>
<DL>
<DD>Create a cryptographic token using specified <code>SecretKey</code>.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>skey</CODE> - The specified <code>SecretKey</code> to use to encrypt the token.</DL>
</DL>
<HR>

<A NAME="CryptoToken(java.lang.String)"><!-- --></A><H3>
CryptoToken</H3>
<PRE>
public <B>CryptoToken</B>(java.lang.String&nbsp;token)
            throws <A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></PRE>
<DL>
<DD>Create using previously encrypted token encrypted with default secret
 key from <b>ESAPI.properties</b>.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>token</CODE> - A previously encrypted token returned by one of the
              <code>getToken()</code> or <code>updateToken()</code> methods. The
              token <i>must</i> have been previously encrypted using the
              using default secret key from the <b>ESAPI.properties</b>
              property <b>Encryptor.MasterKey</b>.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></CODE> - Thrown if they are any problems while decrypting
                              the token using the default secret key from
                              <b>ESAPI.properties</b> or if the decrypted
                              token is not properly formatted.</DL>
</DL>
<HR>

<A NAME="CryptoToken(javax.crypto.SecretKey, java.lang.String)"><!-- --></A><H3>
CryptoToken</H3>
<PRE>
public <B>CryptoToken</B>(javax.crypto.SecretKey&nbsp;skey,
                   java.lang.String&nbsp;token)
            throws <A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></PRE>
<DL>
<DD>Create cryptographic token using previously encrypted token that was
 encrypted with specified secret key.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>token</CODE> - A previously encrypted token returned by one of the
              <code>getToken()</code> or <code>updateToken()</code> methods.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></CODE> - Thrown if they are any problems while decrypting
                              the token using the default secret key from
                              <b>ESAPI.properties</b> or if the decrypted
                              token is not properly formatted.</DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="getUserAccountName()"><!-- --></A><H3>
getUserAccountName</H3>
<PRE>
public java.lang.String <B>getUserAccountName</B>()</PRE>
<DL>
<DD>Retrieve the user account name associated with this <code>CryptoToken</code>
 object.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>The user account name. The string represented by
          <A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#ANONYMOUS_USER"><CODE>ANONYMOUS_USER</CODE></A> is returned if
          <A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setUserAccountName(java.lang.String)"><CODE>setUserAccountName(String)</CODE></A> was never called.</DL>
</DD>
</DL>
<HR>

<A NAME="setUserAccountName(java.lang.String)"><!-- --></A><H3>
setUserAccountName</H3>
<PRE>
public void <B>setUserAccountName</B>(java.lang.String&nbsp;userAccountName)
                        throws <A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></PRE>
<DL>
<DD>Set the user account name associated with this cryptographic token
 object. The user account name is converted to lower case.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>userAccountName</CODE> - The user account name.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></CODE> - Thrown if user account name is not valid, i.e.,
                              if it doesn't conform to the regular expression
                              given by "[a-z][a-z0-9_.@-]*". (Note that the
                              parameter <code>userAccountName</code> is first converted
                              to lower case before checked against the regular
                              expression.)</DL>
</DD>
</DL>
<HR>

<A NAME="isExpired()"><!-- --></A><H3>
isExpired</H3>
<PRE>
public boolean <B>isExpired</B>()</PRE>
<DL>
<DD>Check if token has expired yet.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>True if token has expired; false otherwise.</DL>
</DD>
</DL>
<HR>

<A NAME="setExpiration(int)"><!-- --></A><H3>
setExpiration</H3>
<PRE>
public void <B>setExpiration</B>(int&nbsp;intervalSecs)
                   throws java.lang.IllegalArgumentException</PRE>
<DL>
<DD>Set expiration time to expire in 'interval' seconds (NOT milliseconds).
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>interval</CODE> - Number of seconds in the future from current date/time
                  to set expiration. Must be positive.
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="setExpiration(java.util.Date)"><!-- --></A><H3>
setExpiration</H3>
<PRE>
public void <B>setExpiration</B>(java.util.Date&nbsp;expirationDate)
                   throws java.lang.IllegalArgumentException</PRE>
<DL>
<DD>Set expiration time for a specific date/time.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>expirationDate</CODE> - The date/time at which the token will fail. Must
                          be after the current date/time.
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - Thrown if the parameter is null.</DL>
</DD>
</DL>
<HR>

<A NAME="getExpiration()"><!-- --></A><H3>
getExpiration</H3>
<PRE>
public long <B>getExpiration</B>()</PRE>
<DL>
<DD>Return the expiration time in milliseconds since epoch time (midnight,
 January 1, 1970 UTC).
<P>
<DD><DL>

<DT><B>Returns:</B><DD>The current expiration time.</DL>
</DD>
</DL>
<HR>

<A NAME="getExpirationDate()"><!-- --></A><H3>
getExpirationDate</H3>
<PRE>
public java.util.Date <B>getExpirationDate</B>()</PRE>
<DL>
<DD>Return the expiration time as a <code>Date</code>.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>The <code>Date</code> object representing the expiration time.</DL>
</DD>
</DL>
<HR>

<A NAME="setAttribute(java.lang.String, java.lang.String)"><!-- --></A><H3>
setAttribute</H3>
<PRE>
public void <B>setAttribute</B>(java.lang.String&nbsp;name,
                         java.lang.String&nbsp;value)
                  throws <A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></PRE>
<DL>
<DD>Set a name/value pair as an attribute.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>name</CODE> - The attribute name<DD><CODE>value</CODE> - The attribute value
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></CODE> - Thrown if the attribute name is not properly
                              formed. That is, the attribute name does not
                              match the regular expression "[A-Za-z0-9_.-]+".</DL>
</DD>
</DL>
<HR>

<A NAME="addAttributes(java.util.Map)"><!-- --></A><H3>
addAttributes</H3>
<PRE>
public void <B>addAttributes</B>(java.util.Map&lt;java.lang.String,java.lang.String&gt;&nbsp;attrs)
                   throws <A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></PRE>
<DL>
<DD>Add the specified collection of attributes to the current attributes.
 If there are duplicate attributes specified, they will replace any
 existing ones.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>attrs</CODE> - Name/value pairs of attributes to add or replace the existing
              attributes. Map must be non-null, but may be empty.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></CODE> - Thrown if one of the keys in the specified
                             parameter <code>attrs</code> is not a valid name.
                             That is, all attribute names must match the regular
                             expression ""[A-Za-z0-9_.-]+".<DT><B>See Also:</B><DD><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#setAttribute(java.lang.String, java.lang.String)"><CODE>setAttribute(String, String)</CODE></A></DL>
</DD>
</DL>
<HR>

<A NAME="getAttribute(java.lang.String)"><!-- --></A><H3>
getAttribute</H3>
<PRE>
public java.lang.String <B>getAttribute</B>(java.lang.String&nbsp;name)</PRE>
<DL>
<DD>Retrieve the attribute with the specified name.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>name</CODE> - The attribute name.
<DT><B>Returns:</B><DD>The value associated with the attribute name. If attribute is not
          set, then <code>null</code> is returned.</DL>
</DD>
</DL>
<HR>

<A NAME="getAttributes()"><!-- --></A><H3>
getAttributes</H3>
<PRE>
public java.util.Map&lt;java.lang.String,java.lang.String&gt; <B>getAttributes</B>()</PRE>
<DL>
<DD>Retrieve a <code>Map</code> that is a clone of all the attributes. A <i>copy</i>
 is returned so that the attributes in <code>CrytpToken</code> are unaffected
 by alterations made the returned <code>Map</code>. (Otherwise, multi-threaded code
 could get trick.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>A <code>Map</code> of all the attributes.<DT><B>See Also:</B><DD><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getAttribute(java.lang.String)"><CODE>getAttribute(String)</CODE></A></DL>
</DD>
</DL>
<HR>

<A NAME="clearAttributes()"><!-- --></A><H3>
clearAttributes</H3>
<PRE>
public void <B>clearAttributes</B>()</PRE>
<DL>
<DD>Removes all the attributes (if any) associated with this token. Note
 that this does not clear / reset the user account name or expiration time.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="getToken(javax.crypto.SecretKey)"><!-- --></A><H3>
getToken</H3>
<PRE>
public java.lang.String <B>getToken</B>(javax.crypto.SecretKey&nbsp;skey)
                          throws <A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></PRE>
<DL>
<DD>Return the new encrypted token as a base64-encoded string, encrypted with
 the specified <code>SecretKey</code> which may be a different key than what the
 token was originally encrypted with. E.g.,
 <pre>
   Alice:
      SecretKey aliceSecretKey = ...; // Shared with Bob
      CryptoToken cryptoToken = new CryptoToken(skey1);
      cryptoToken.setUserAccountName("kwwall");
      cryptoToken.setAttribute("role", "admin");
      cryptoToken.setAttribute("state", "Ohio");
      String token = cryptoToken.getToken(); // Encrypted with skey1
      // send token to Bob ...
  --------------------------------------------------------------------
  Bob:
      ...
      SecretKey aliceSecretKey = ...  // Shared with Alice
      SecretKey bobSecretKey = ...;   // Shared with Carol
      CryptoToken cryptoToken = new CryptoToken(aliceSecretKey, tokenFromAlice);
      
      // Re-encrypt for Carol using my (Bob's) key...
      String tokenForCarol = cryptoToken.getToken(bobSecretKey);
      // send tokenForCarol to Carol ...
      // use token ourselves
  --------------------------------------------------------------------
  Carol:
      ...
      SecretKey bobSecretKey = ...;   // Shared with Bob.
      CryptoToken cryptoToken = new CryptoToken(bobSecretKey, tokenFromBob);
      if ( ! cryptoToken.isExpired() ) {
          String userName = cryptoToken.getUserAccountName();
          String roleName = cryptoToken.getAttribute("role");
          if ( roleName != null && roleName.equalsIgnoreCase("admin") ) {
              // grant admin access...
              ...
          }
      }
      ...
 </pre>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>skey</CODE> - The specified key to (re)encrypt the token.
<DT><B>Returns:</B><DD>The newly encrypted token.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></CODE></DL>
</DD>
</DL>
<HR>

<A NAME="updateToken(int)"><!-- --></A><H3>
updateToken</H3>
<PRE>
public java.lang.String <B>updateToken</B>(int&nbsp;additionalSecs)
                             throws <A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A>,
                                    <A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></PRE>
<DL>
<DD>Update the (current) expiration time by adding the specified number of
 seconds to it and then re-encrypting with the current <code>SecretKey</code>
 that was used to construct this object.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>additionalSecs</CODE> - The additional number of seconds to add to the
                          current expiration time. This number must be
                          &gt;= 0 or otherwise an <code>IllegalArgumentException</code>
                          is thrown.
<DT><B>Returns:</B><DD>The re-encrypted token with the updated expiration time is returned.
<DT><B>Throws:</B>
<DD><CODE>java.lang.IllegalArgumentException</CODE> - Thrown if parameter <code>additionalSecs</code>
                                      is less than 0.
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></CODE> - Thrown if the encryption fails.
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/ValidationException.html" title="class in org.owasp.esapi.errors">ValidationException</A></CODE> - Thrown if the token will have already expired
                                      even after adding the specified number of
                                      additional seconds.
<DD><CODE>java.lang.ArithmeticException</CODE> - If additional seconds is large enough such
                                      that it would cause an arithmetic overflow
                                      with a long (the current expiration time)
                                      when added to the <code>additionalSecs</code>
                                      parameter.</DL>
</DD>
</DL>
<HR>

<A NAME="getToken()"><!-- --></A><H3>
getToken</H3>
<PRE>
public java.lang.String <B>getToken</B>()
                          throws <A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></PRE>
<DL>
<DD>Return the new encrypted token as a base64-encoded string, encrypted with
 the specified <code>SecretKey</code> with which this object was constructed.
<P>
<DD><DL>

<DT><B>Returns:</B><DD>The newly encrypted token.
<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../org/owasp/esapi/errors/EncryptionException.html" title="class in org.owasp.esapi.errors">EncryptionException</A></CODE><DT><B>See Also:</B><DD><A HREF="../../../../org/owasp/esapi/crypto/CryptoToken.html#getToken(javax.crypto.SecretKey)"><CODE>getToken(SecretKey)</CODE></A></DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/CryptoToken.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../org/owasp/esapi/crypto/CryptoHelper.html" title="class in org.owasp.esapi.crypto"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../org/owasp/esapi/crypto/KeyDerivationFunction.html" title="class in org.owasp.esapi.crypto"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?org/owasp/esapi/crypto/CryptoToken.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="CryptoToken.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
Copyright &#169; 2011 <a href="http://www.owasp.org/index.php">The Open Web Application Security Project (OWASP)</a>. All Rights Reserved.
</BODY>
</HTML>
